# doc: https://docs.prow.k8s.io/docs/components/optional/branchprotector/
# https://github.com/cloudfoundry/community/blob/main/toc/rfc/rfc-0015-branch-protection.md
branch-protection:
  orgs:
    cloudfoundry:
      repos:
        # example repo configured as if the project would belong to ARD WG, area CF Deployment
        # automation would generate repo/branch config for all repos belonging to a WG unless an explicit configuration exists here
        branchprotection-test:
          protect: true
          enforce_admins: true
          allow_force_pushes: false
          allow_deletions: false
          allow_disabled_policies: true  # needed to allow branches w/o branch protection
          required_pull_request_reviews:
            dismiss_stale_reviews: true
            require_code_owner_reviews: true
            required_approving_review_count: 1 # area has >=4 approvers
            bypass_pull_request_allowances:
              teams: ["wg-app-runtime-deployments-bots"] # no area bots configured
          include: [ "^main$", "^v[0-9]*$"]
        cf-relint-ci-semver:
          protect: false
        relint-ci-pools:
          protect: false
        relint-envs:
          protect: false

        # App Runtime Platform repos to skip branch protection on
        diego-acceptance:
          protect: false
        diego-checkman:
          protect: false
        diego-team:
          protect: false
        garden-ci:
          protect: false
        garden-wiki:
          protect: false
        networking-oss-deployments:
          protect: false
        routing-team-checklists:
          protect: false
        runtime-credentials:
          protect: false
        docs-book-cloudfoundry:
          protect: false
        docs-cf-admin:
          protect: false
        docs-loggregator:
          protect: false
        docs-running-cf:
          protect: false
        haproxy-boshrelease:
          protect: true
          enforce_admins: false
          allow_force_pushes: false
          allow_deletions: false
          allow_disabled_policies: true
          include: ["^master$"]
          required_status_checks:
            contexts: ["concourse-ci/unit-tests","concourse-ci/acceptance-tests"]
          required_pull_request_reviews:
            dismiss_stale_reviews: true
            require_code_owner_reviews: true
            required_approving_review_count: 1
            bypass_pull_request_allowances:
              teams: ["wg-app-runtime-platform-bots"]
        pcap-release:
          protect: true
          enforce_admins: false
          allow_force_pushes: false
          allow_deletions: false
          allow_disabled_policies: true
          include: ["^main$"]
          required_status_checks:
            contexts: ["concourse-ci/unit-tests","concourse-ci/acceptance-tests"]
          required_pull_request_reviews:
            dismiss_stale_reviews: true
            require_code_owner_reviews: true
            required_approving_review_count: 1
            bypass_pull_request_allowances:
              teams: ["wg-app-runtime-platform-bots"]

        # CF-on-K8s
        korifi-ci:
          protect: false
        cf-k8s-secrets:
          protect: false
        korifi:
          protect: true
          enforce_admins: true
          allow_force_pushes: false
          allow_deletions: false
          allow_disabled_policies: true
          include: ["^main$"]
          required_status_checks:
            contexts:
              - "api-tests"
              - "controllers-tests"
              - "linter"
              - "job-task-runner-tests"
              - "kpack-image-builder-tests"
              - "statefulset-runner-tests"
              - "tools-tests"
              - "Concourse / e2e-tests (pull_request)"
              - "Concourse / e2e-eks-tests (pull_request)"
              - "EasyCLA"
          required_pull_request_reviews:
            dismiss_stale_reviews: true
            require_code_owner_reviews: true
            required_approving_review_count: 1
